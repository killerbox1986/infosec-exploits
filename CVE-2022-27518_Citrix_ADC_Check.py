# The following script checks if a Citrix ADC is vulberable to unauth remote code execution by comparing the MD5 hash of the VPN/index.html file
# A reverse shell exploit code will be available soon on this repo.
# Not all Citrix ADC platforms respond back with the MD5 value that has version information identifier, Please verify the local installed package.
# The citrix ADC gateways/servers must be configured to use SAML for CVE-2022-27518 to work.
# Modify the vpn/index.html path according to the configuration your working with.
# 


# -*- coding: utf-8 -*-

import requests
import json
import sys
import getpass
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def main():
    target = sys.argv[1]
    url = "https://" + target + "/vpn/index.html"
    try:
        r = requests.get(url, verify=False)
        if "c1b64cea1b80e973580a73b787828daf" in r.text:
            print("Citrix version 12.1-65.21 is vulnerable to CVE-2022-27518")
        if "f3d4041188d723fec4547b1942ffea93" in r.text:
            print("Citrix version 12.1-63.22 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
        if "4ecb5abf6e4b1655c07386a2c958597c" in r.text:
            print("Citrix version 12.1-57.18 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
        if "fd96bc8977256003de05ed84270b90bb" in r.text:
            print("Citrix version 13.0-47.24 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
        if "02d30141fd053d5c3448bf04fbedb8d6" in r.text:
            print("Citrix version 12.1-55.18 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
        if "fbdc5fbaed59f858aad0a870ac4a779c" in r.text:
            print("Citrix version 12.1-65.15 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
        if "e1ebdcea7585d24e9f380a1c52a77f5d" in r.text:
            print("Citrix version 12.1-62.27 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
        if "e79f3bbf822c1fede6b5a1a4b6035a41" in r.text:
            print("Citrix version 13.0-52.24 is vulnerable to CVE-2022-27510 & CVE-2022-27518")
            sys.exit(0)
        else:
            print("Citrix is not vulnerable, please verify the local package installed")
            sys.exit(1)
    except requests.exceptions.RequestException as e:
        print(e)
        sys.exit(1)
    except requests.exceptions.HTTPError as e:
        print(e)
        sys.exit(1)
    except requests.exceptions.ConnectionError as e:
        print(e)
        sys.exit(1)
    except requests.exceptions.Timeout as e:
        print(e)
        sys.exit(1)
    except requests.exceptions.TooManyRedirects as e:
        print(e)
        sys.exit(1)
    except requests.exceptions.SSLError as e:
        print(e)
        sys.exit(1)
    except requests.exceptions.ProxyError as e:
        print(e)
        sys.exit(1)

if __name__ == "__main__":
    main()
    sys.exit(0)

# Run the script
# python Citrix_RCE_Check.py
# Enter the target server IP address:
